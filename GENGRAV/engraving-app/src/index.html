<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>GENGRAV Laser Engraver - GRBL 1.1</title>
  <link rel="stylesheet" href="index.css">
</head>

<body>
  <div class="app">
    <header class="header">
      <div class="brand">
        <span class="logo">‚ö°</span>
        <h1>GENGRAV</h1>
        <span class="version">v2.0 (GRBL 1.1)</span>
      </div>
      <div class="status-bar">
        <div id="connectionStatus" class="connection disconnected">
          <span class="dot"></span>
          <span class="text">Disconnected</span>
        </div>
        <div id="dbStatus" class="connection disconnected" title="Database Connection">
          <span class="dot"></span>
          <span class="text">DB: Offline</span>
        </div>
        <div class="position">
          <span>X: <b id="posX">0.000</b></span>
          <span>Y: <b id="posY">0.000</b></span>
          <span>Z: <b id="posZ">0.000</b></span>
        </div>
        <div class="machine-state"><span id="machineState">--</span></div>
        <!-- GRBL 1.1 Overrides Display -->
        <div class="overrides">
          <span title="Feed Override">F:<b id="feedOvr">100</b>%</span>
          <span title="Spindle/Laser Override">S:<b id="spindleOvr">100</b>%</span>
        </div>
      </div>
    </header>

    <main class="main">
      <!-- Left Panel -->
      <aside class="panel left-panel">
        <!-- Connection -->
        <section class="section">
          <h2>üîå Connection</h2>
          <div class="row">
            <select id="portSelect">
              <option value="">Select Port</option>
            </select>
            <button id="refreshBtn" class="btn-icon">üîÑ</button>
          </div>
          <div class="row">
            <select id="baudSelect">
              <option value="115200" selected>115200</option>
              <option value="250000">250000</option>
              <option value="230400">230400</option>
              <option value="57600">57600</option>
              <option value="38400">38400</option>
              <option value="19200">19200</option>
              <option value="9600">9600</option>
            </select>
            <span class="badge">baud</span>
          </div>
          <div class="row">
            <button id="connectBtn" class="btn primary">Connect</button>
            <button id="disconnectBtn" class="btn" disabled>Disconnect</button>
          </div>
          <div class="connection-options">
            <label class="checkbox-label">
              <input type="checkbox" id="dtrReset" checked>
              <span>DTR/RTS Reset</span>
            </label>
            <label class="checkbox-label">
              <input type="checkbox" id="softReset" checked>
              <span>Soft Reset (Ctrl-X)</span>
            </label>
          </div>
        </section>

        <!-- GRBL Settings -->
        <section class="section">
          <h2>‚öôÔ∏è GRBL Configuration</h2>
          <div class="badges">
            <span id="laserBadge" class="badge">$32: --</span>
            <span id="versionBadge" class="badge">Ver: --</span>
          </div>
          <div class="grid-2">
            <button id="readSettingsBtn" class="btn sm" disabled>Read</button>
            <button id="saveSettingsBtn" class="btn sm success" disabled>Save</button>
            <button id="enableLaserBtn" class="btn sm warning" disabled>Laser Mode</button>
            <button id="applyDefaultsBtn" class="btn sm" disabled>Defaults</button>
          </div>

          <!-- Editable GRBL Config -->
          <div class="grbl-config">
            <div class="config-row">
              <label>$22 Homing</label>
              <select id="config22" disabled>
                <option value="0">Disabled</option>
                <option value="1">Enabled</option>
              </select>
            </div>
            <div class="config-row">
              <label>$100 X steps/mm</label>
              <input type="number" id="config100" step="0.1" disabled>
            </div>
            <div class="config-row">
              <label>$101 Y steps/mm</label>
              <input type="number" id="config101" step="0.1" disabled>
            </div>
          </div>
          
          <!-- Laser Controls -->
          <div class="laser-controls">
            <h3>üî¶ Laser Test</h3>
            <div class="row">
              <button id="laserTestBtn" class="btn sm warning" disabled>Test Fire</button>
              <button id="laserFocusBtn" class="btn sm" disabled>Focus</button>
              <button id="laserOffBtn" class="btn sm danger" disabled>OFF</button>
            </div>
            <div class="config-row">
              <label>Power %</label>
              <input type="range" id="testPower" min="1" max="100" value="5" disabled>
              <span id="testPowerValue">5%</span>
            </div>
          </div>
        </section>

        <!-- Machine Control -->
        <section class="section">
          <h2>üéÆ Machine Control</h2>
          <div class="row">
            <button id="homeBtn" class="btn" disabled>üè† Set Home</button>
            <button id="goHomeBtn" class="btn" disabled>üéØ Go Home</button>
          </div>
          <div class="jog-pad">
            <button id="jogYPlus" class="jog-btn" disabled>‚ñ≤</button>
            <div class="jog-row">
              <button id="jogXMinus" class="jog-btn" disabled>‚óÄ</button>
              <button id="jogCenter" class="jog-btn center" disabled>‚åÇ</button>
              <button id="jogXPlus" class="jog-btn" disabled>‚ñ∂</button>
            </div>
            <button id="jogYMinus" class="jog-btn" disabled>‚ñº</button>
            <select id="jogStep" class="jog-step">
              <option value="0.1">0.1mm</option>
              <option value="1" selected>1mm</option>
              <option value="10">10mm</option>
            </select>
          </div>
        </section>

        <!-- Emergency -->
        <section class="section">
          <button id="emergencyBtn" class="btn emergency">‚ö†Ô∏è EMERGENCY STOP</button>
          <div class="row" style="margin-top: 8px;">
            <button id="unlockBtn" class="btn sm warning" disabled>üîì Unlock</button>
            <button id="resetBtn" class="btn sm" disabled>‚Üª Reset</button>
          </div>
        </section>
        
        <!-- GRBL 1.1 Overrides -->
        <section class="section overrides-section">
          <h2>üéöÔ∏è GRBL 1.1 Overrides</h2>
          <div class="override-control">
            <label>Feed Rate</label>
            <div class="override-buttons">
              <button id="feedMinus10" class="btn sm" disabled title="-10%">-10</button>
              <button id="feedMinus1" class="btn sm" disabled title="-1%">-1</button>
              <span id="feedOverrideVal" class="override-val">100%</span>
              <button id="feedPlus1" class="btn sm" disabled title="+1%">+1</button>
              <button id="feedPlus10" class="btn sm" disabled title="+10%">+10</button>
              <button id="feedReset" class="btn sm" disabled title="Reset">‚Üª</button>
            </div>
          </div>
          <div class="override-control">
            <label>Spindle/Laser</label>
            <div class="override-buttons">
              <button id="spindleMinus10" class="btn sm" disabled title="-10%">-10</button>
              <button id="spindleMinus1" class="btn sm" disabled title="-1%">-1</button>
              <span id="spindleOverrideVal" class="override-val">100%</span>
              <button id="spindlePlus1" class="btn sm" disabled title="+1%">+1</button>
              <button id="spindlePlus10" class="btn sm" disabled title="+10%">+10</button>
              <button id="spindleReset" class="btn sm" disabled title="Reset">‚Üª</button>
            </div>
          </div>
          <div class="override-control">
            <label>Rapid</label>
            <div class="override-buttons">
              <button id="rapidFull" class="btn sm" disabled>100%</button>
              <button id="rapid50" class="btn sm" disabled>50%</button>
              <button id="rapid25" class="btn sm" disabled>25%</button>
            </div>
          </div>
        </section>
      </aside>

      <!-- Center Panel -->
      <section class="panel center-panel">
        <!-- QR Code Database Section -->
        <div class="qr-database-section">
          <div class="section-header">
            <h2>üì± QR Codes from Database</h2>
            <button id="refreshQRBtn" class="btn sm">üîÑ Refresh</button>
          </div>
          <div id="qrList" class="qr-list">
            <span class="hint">Click Refresh to load QR codes from database</span>
          </div>
        </div>
        
        <div class="preview-box">
          <h2>üì∑ Preview</h2>
          <div id="preview" class="preview"><span class="hint">Select QR from database or load image</span></div>
          <input type="file" id="fileInput" accept="image/*" hidden>
        </div>
        <div class="actions">
          <button id="loadImageBtn" class="btn">üìÇ Load</button>
          <button id="engravingSettingsBtn" class="btn">‚öôÔ∏è Settings</button>
          <button id="generateBtn" class="btn primary" disabled>Generate G-code</button>
          <button id="previewGCodeBtn" class="btn" disabled>üëÅÔ∏è View G-code</button>
          <button id="startBtn" class="btn success" disabled>‚ñ∂ Start</button>
          <button id="stopBtn" class="btn danger" disabled>‚¨õ Stop</button>
        </div>
        
        <!-- Engraving Settings Summary -->
        <div class="settings-summary">
          <span>Speed: <b id="summarySpeed">300</b> mm/min</span>
          <span>S-MIN: <b id="summarySMin">0</b></span>
          <span>S-MAX: <b id="summarySMax">700</b></span>
          <span>Size: <b id="summarySize">100x100</b> mm</span>
        </div>
        <div id="progressBox" class="progress-box" hidden>
          <div class="progress-bar">
            <div id="progressFill" class="fill"></div>
          </div>
          <span id="progressText">0%</span>
        </div>
      </section>

      <!-- Right Panel: Console -->
      <aside class="panel right-panel">
        <section class="section console-section">
          <div class="console-header">
            <h2>üíª Console</h2>
            <button id="clearConsoleBtn" class="btn-icon">üóëÔ∏è</button>
          </div>
          <div id="console" class="console"></div>
          <div class="console-input">
            <input type="text" id="cmdInput" placeholder="G-code">
            <button id="sendCmdBtn" class="btn sm" disabled>Send</button>
          </div>
        </section>
      </aside>
    </main>
  </div>
  
  <!-- Engraving Settings Modal -->
  <div id="settingsModal" class="modal" hidden>
    <div class="modal-content">
      <div class="modal-header">
        <h2>‚öôÔ∏è Engraving Settings</h2>
        <button id="closeSettingsBtn" class="btn-close">‚úï</button>
      </div>
      <div class="modal-body">
        <!-- Speed Section -->
        <div class="settings-group">
          <h3>Speed</h3>
          <div class="setting-row">
            <label for="engravingSpeed">Engraving Speed</label>
            <input type="number" id="engravingSpeed" value="300" min="10" max="10000" step="10">
            <span class="unit">mm/min</span>
          </div>
        </div>
        
        <!-- Laser Options Section -->
        <div class="settings-group">
          <h3>Laser Options</h3>
          <div class="setting-row">
            <label for="laserMode">Laser Mode</label>
            <select id="laserMode">
              <option value="M3">M3 - Constant Power</option>
              <option value="M4">M4 - Dynamic Power</option>
            </select>
          </div>
          <div class="setting-row">
            <label for="sMin">S-MIN (0-1000)</label>
            <input type="number" id="sMin" value="0" min="0" max="1000" step="1">
            <span class="unit" id="sMinPercent">0.0%</span>
          </div>
          <div class="setting-row">
            <label for="sMax">S-MAX (0-1000)</label>
            <input type="number" id="sMax" value="700" min="0" max="1000" step="1">
            <span class="unit" id="sMaxPercent">70.0%</span>
          </div>
        </div>
        
        <!-- Image Size Section -->
        <div class="settings-group">
          <h3>Image Size and Position [mm]</h3>
          <div class="setting-row">
            <label>
              <input type="checkbox" id="autoSize" checked>
              Autosize
            </label>
            <input type="number" id="dpi" value="300" min="72" max="1200" step="1">
            <span class="unit">DPI</span>
          </div>
          <div class="setting-row">
            <label for="sizeW">Width</label>
            <input type="number" id="sizeW" value="100" min="1" max="500" step="0.1">
            <span class="unit">mm</span>
          </div>
          <div class="setting-row">
            <label for="sizeH">Height</label>
            <input type="number" id="sizeH" value="100" min="1" max="500" step="0.1">
            <span class="unit">mm</span>
          </div>
          <div class="setting-row">
            <label for="offsetX">Offset X</label>
            <input type="number" id="offsetX" value="0" min="-500" max="500" step="0.1">
            <span class="unit">mm</span>
          </div>
          <div class="setting-row">
            <label for="offsetY">Offset Y</label>
            <input type="number" id="offsetY" value="0" min="-500" max="500" step="0.1">
            <span class="unit">mm</span>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button id="resetSettingsBtn" class="btn">‚Üª Reset Defaults</button>
        <button id="cancelSettingsBtn" class="btn">Cancel</button>
        <button id="saveSettingsBtn" class="btn success">‚úì Save Settings</button>
      </div>
    </div>
  </div>
  
  <!-- G-Code Preview Modal -->
  <div id="gcodeModal" class="modal" hidden>
    <div class="modal-content modal-wide">
      <div class="modal-header">
        <h2>üìÑ Generated G-Code</h2>
        <button id="closeGCodeBtn" class="btn-close">‚úï</button>
      </div>
      <div class="modal-body">
        <div class="gcode-info">
          <span id="gcodeLineCount">0 lines</span>
          <span id="gcodeEstimatedTime">Est. time: --</span>
        </div>
        <textarea id="gcodePreview" class="gcode-preview" readonly></textarea>
      </div>
      <div class="modal-footer">
        <button id="copyGCodeBtn" class="btn">üìã Copy</button>
        <button id="downloadGCodeBtn" class="btn">üíæ Download</button>
        <button id="closeGCodeModalBtn" class="btn success">Close</button>
      </div>
    </div>
  </div>
</body>

</html>